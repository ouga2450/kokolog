<%= turbo_frame_tag 'modal-content' do %>
  <div class="space-y-6">

    <!-- タイトル -->
    <div class="flex items-center justify-between border-b border-base-300 pb-2">
      <h3 class="font-bold text-lg text-base-content flex items-center gap-2">
        <span class="text-2xl"><%= @habit_log.habit.category.icon %></span>
        <%= @habit_log.habit.name %>
      </h3>

      <span class="badge badge-primary badge-outline text-xs px-2 py-1">
        行動実行 (詳細)
      </span>
    </div>

    <!-- destroy_failure での固定メッセージ -->
    <% if local_assigns[:errors] %>
      <div class="alert alert-soft alert-error max-sm:alert-vertical text-xs font-bold mb-4">
        <div class="flex items-start gap-2">
          <%= heroicon "x-circle", variant: :outline, options: { class: "w-5 h-5 flex-shrink-0" } %>
          <span>削除に失敗しました。もう一度お試しください。</span>
        </div>
      </div>
    <% end %>

    <!-- 目標情報 -->
    <div class="bg-base-200/60 p-3 rounded-lg text-sm">
      <p>
        <span class="font-semibold text-base-content/80">目標：</span>
        <%= @habit_log.habit.goal.display_goal %>
      </p>
    </div>

    <!-- 実行量 -->
    <% if @habit_log.goal.goal_unit != "check_based" %>
      <div class="bg-base-200/50 p-3 rounded-lg text-sm space-y-1">
        <p class="font-semibold text-base-content/80">実行量</p>
        <p class="text-base-content">
          <%= @habit_log.performed_value.present? ? @habit_log.performed_value : "—" %>
          <%# 単位の表示（例：回 / 分）%>
          <% if @habit_log.goal.goal_unit == "count_based" %>
            回
          <% elsif @habit_log.goal.goal_unit == "time_based" %>
            分
          <% end %>
        </p>
      </div>
    <% end %>

    <!-- 開始時刻 -->
    <div class="bg-base-200/50 p-3 rounded-lg text-sm space-y-1">
      <p class="font-semibold text-base-content/80">開始時刻</p>
      <p class="text-base-content">
        <%= l @habit_log.started_at, format: :long %>
      </p>
    </div>

    <!-- 終了時刻（あれば） -->
    <% if @habit_log.ended_at.present? %>
      <div class="bg-base-200/50 p-3 rounded-lg text-sm space-y-1">
        <p class="font-semibold text-base-content/80">終了時刻</p>
        <p class="text-base-content">
          <%= l @habit_log.ended_at, format: :long %>
        </p>
      </div>
    <% end %>

    <!-- 気分ログ --->
    <% before = @habit_log.before_mood_log %>
    <% after = @habit_log.after_mood_log %>
    <!-- 気分ログ（before） -->
    <% if before.present? %>
      <div class="bg-base-200/40 p-3 rounded-lg text-sm space-y-1">
        <p class="font-semibold text-base-content/80">実行前の気分</p>
        <p class="text-base-content">
          <%= [emoji_for_mood(before.mood), jp_label_for_mood(before.mood)].compact.join(" ") %>
          <% if before.feeling.present? %>
            （<%= before.feeling.name %>）
          <% end %>
        </p>
      </div>
    <% end %>

    <!-- 気分ログ（after） -->
    <% if after.present? %>
      <div class="bg-base-200/40 p-3 rounded-lg text-sm space-y-1">
        <p class="font-semibold text-base-content/80">実行後の気分</p>
        <p class="text-base-content">
          <%= [emoji_for_mood(after.mood), jp_label_for_mood(after.mood)].compact.join(" ") %>
          <% if after.feeling.present? %>
            （<%= after.feeling.name %>）
          <% end %>
        </p>
      </div>
    <% end %>

    <!-- アクションボタン -->
    <div class="modal-action flex justify-between items-center pt-4 border-t border-base-300">
      <div class="flex gap-2">
        <%= link_to "編集",
                    edit_habit_log_path(@habit_log, dom_from: params[:dom_from], from: "edit"),
                    class: "btn btn-sm btn-outline btn-primary h-9 min-h-9 px-4",
                    data: { turbo_frame: "modal", turbo_prefetch: "false" } %>

        <%= link_to "削除",
                        habit_log_path(@habit_log,dom_from: params[:dom_from], from: "show"),
                        data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" },
                        class: "btn btn-sm btn-outline btn-error h-9 min-h-9 px-4" %>
      </div>

      <button type="button"
              data-action="click->modal#close"
              class="btn btn-sm btn-outline h-9 min-h-9 px-4">
        閉じる
      </button>
    </div>
    </div>

  </div>
<% end %>

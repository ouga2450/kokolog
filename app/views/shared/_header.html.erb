<header class="navbar sticky top-0 z-50 bg-base-100/80 backdrop-blur border-b border-base-300/40 shadow-sm">
  <div class="w-full max-w-lg mx-auto flex items-center justify-between px-4">

    <!-- 左側・ロゴ -->
    <%= link_to root_path, class: "font-bold text-xl tracking-wide text-primary" do %>
      koco<span class="text-accent">log</span>
    <% end %>

    <!-- 右側・テーマスイッチ + ハンバーガー -->
    <div class="flex items-center gap-3">

      <!-- テーマトグル -->
      <label data-controller="theme-toggle" class="flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          data-theme-toggle-target="checkbox"
          data-action="change->theme-toggle#switch"
          class="toggle toggle-primary"
        />

        <!-- Light アイコン -->
        <span data-theme-toggle-target="iconLight">
          <%= heroicon "sun", options: { class: "w-5 h-5 text-warning" } %>
        </span>

        <!-- Dark アイコン -->
        <span data-theme-toggle-target="iconDark" class="hidden">
          <%= heroicon "moon", options: { class: "w-5 h-5 text-info" } %>
        </span>
      </label>

      <!-- ▼ ハンバーガーメニュー -->
      <div class="relative" data-controller="nav-menu">
        <input id="nav-menu-toggle" type="checkbox" class="hidden peer/nav" />

        <label for="nav-menu-toggle"
               class="btn btn-circle btn-ghost swap swap-rotate peer-checked/nav:swap-active">
          <%= heroicon "bars-3", options: { class: "w-6 h-6 swap-off" } %>
          <%= heroicon "x-mark", options: { class: "w-6 h-6 swap-on" } %>
        </label>

        <!-- ▼ メニュー -->
        <ul class="menu menu-sm absolute right-0 mt-3 w-52 rounded-xl bg-base-100 p-2 shadow-xl hidden
                   peer-checked/nav:flex peer-checked/nav:flex-col">
          <% if user_signed_in? %>
            <li class="text-sm font-semibold mb-1 text-base-content/80">
              <%= current_user.name %> さん
            </li>
            <li><%= link_to t("navigation.home"), home_path %></li>
            <li><%= link_to t("navigation.habits"), habits_path %></li>
            <li><%= link_to t("navigation.calendar"), calendars_path %></li>
            <li><%= link_to t("navigation.reflection"), reaction_today_path %></li>
            <li><%= link_to t("navigation.mypages"), mypage_path %></li>
            <li><%= link_to t("navigation.onboarding"), onboarding_path %></li>
            <li>
              <%= link_to t("actions.logout"), destroy_user_session_path,
                           data: { turbo_method: :delete },
                           class: "text-error" %>
            </li>

            <li class="border-t my-1"></li>
            <li><%= link_to t("navigation.terms"), terms_path, class: "text-xs" %></li>
            <li><%= link_to t("navigation.privacy_policy"), privacy_path, class: "text-xs" %></li>
          <% else %>
            <li><%= link_to t("navigation.top"), top_path %></li>
            <li><%= link_to t("actions.login"), new_user_session_path %></li>
            <li><%= link_to t("actions.sign_up"), new_user_registration_path %></li>

            <li class="border-t my-1"></li>
            <li><%= link_to t("navigation.terms"), terms_path, class: "text-xs" %></li>
            <li><%= link_to t("navigation.privacy_policy"), privacy_path, class: "text-xs" %></li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</header>

<%= form_with model: MoodLog.new,
                url: mood_logs_path,
                method: :post,
                data: {controller: "mood-selector"} do |f| %>
  <section class="card bg-base-100 shadow-sm" data-controller="toggle-form">
    <div class="card-body">
      <div class="flex justify-between items-center">
        <h2 class="card-title text-sm font-semibold">今の気分は？</h2>
        <p class="text-xs text-base-content/50">タップまたはスライダーで選択</p>
      </div>

      <!-- 選択された気分IDを保持するhiddenフィールド -->
      <%= f.hidden_field :mood_id,
                          value: @moods.find_by(score: 2)&.id,
                          data: { mood_selector_target: "field" } %>

      <!-- 絵文字ボタン群 -->
      <div class="grid grid-cols-5 gap-2 mt-3">
        <% @moods.each_with_index do |mood, i| %>
          <button
            type="button"
            data-action="click->mood-selector#select"
            data-mood-selector-index-value="<%= i %>"
            data-mood-selector-id-value="<%= mood.id %>"
            data-mood-selector-target="button"
            class="mood-btn flex flex-col items-center justify-center p-3 rounded-xl border border-base-300 bg-base-200 hover:bg-base-300 transition-all duration-150"
            >
            <!-- moodsヘルパーメソッドで絵文字と日本語ラベルを取得 -->
            <span class="text-2xl"><%= emoji_for_mood(mood) %></span>
            <span class="text-xs font-medium mt-1"><%= jp_label_for_mood(mood) %></span>
          </button>
        <% end %>
      </div>

      <!-- スライダー -->
      <div class="mt-5 flex items-center justify-center">
        <input
          type="range"
          min="0"
          max="<%= @moods.size - 1 %>"
          value="2"
          step="1"
          class="range range-primary w-full"
          data-action="input->mood-selector#slide"
          data-mood-selector-target="slider"
        />
      </div>

      <!-- 詳細記録フォーム -->
      <div class="mt-4 space-y-3 hidden" data-toggle-form-target="details">

        <!-- メモ欄 -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text text-sm font-medium">メモ</span>
          </label>
          <%= f.text_area :note,
              rows: 3,
              class: "textarea textarea-bordered w-full" %>
        </div>

        <!-- 感情タグ -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text text-sm font-medium">感情タグ</span>
          </label>
          <%= f.select :feeling_id,
              Feeling.pluck(:name, :id),
              { include_blank: "選択してください" },
              class: "select select-bordered select-sm w-full" %>
        </div>

      </div>

      <!-- 保存・詳細記録ボタン -->
      <div class="w-[90%] mx-auto flex gap-4 mt-2">
        <button type="submit" class="btn btn-primary btn-sm flex-1 px-3 flex items-center justify-center gap-2">
          <%= heroicon "check", options: { class: "w-4 h-4" } %>
          保存
        </button>

        <button
          type="button"
          class="btn btn-outline btn-sm flex-1 px-3 flex items-center justify-center gap-2"
          data-action="toggle-form#toggle"
        >
          <span data-toggle-form-target="icon">+</span>
          <span data-toggle-form-target="label">詳細記録</span>
        </button>
      </div>
    </div>
  </section>
<% end %>

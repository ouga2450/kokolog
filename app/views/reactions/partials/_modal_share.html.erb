<%= turbo_frame_tag "modal-content" do %>
  <div class="p-6 space-y-5">

    <!-- è¦‹å‡ºã— -->
    <div class="space-y-1">
      <h2 class="text-sm font-medium text-base-content">
        ã“ã®æ—¥ã®æŒ¯ã‚Šè¿”ã‚Š
      </h2>
      <p class="text-xs text-base-content/50">
        æŠ•ç¨¿ã‚¤ãƒ¡ãƒ¼ã‚¸
      </p>
    </div>

    <%# ===== æŠ•ç¨¿æ–‡ã‚’çµ„ã¿ç«‹ã¦ã‚‹ ===== %>
    <%
      score = @context.avg_mood

      mood_face =
        if score.nil?
          "ğŸ˜¶"
        elsif score >= 4.0
          "ğŸ˜Š"
        elsif score >= 3.0
          "ğŸ™‚"
        elsif score >= 2.0
          "ğŸ˜"
        else
          "ğŸ˜¶"
        end

      activities =
        @context.habit_logs
                .map { |log| log.habit }
                .compact
                .uniq
                .take(4)
                .map { |habit| "#{habit.category.icon} #{habit.name}" }

      activities_text =
        if activities.any?
          activities.join("\n")
        else
          "â˜ï¸ é™ã‹ãªä¸€æ—¥ã§ã—ãŸ"
        end

      tweet_text = <<~TEXT
      ğŸ“… #{@context.date.strftime("%Y/%m/%d")}ã®æŒ¯ã‚Šè¿”ã‚Š
      ğŸŒ± ä»Šæ—¥ã®æ°—åˆ†
      #{mood_face} #{score&.round(2) || "â€”"} / 5
      ğŸ§© ä»Šæ—¥ã‚„ã£ãŸã“ã¨
      #{activities_text}
      #kokolog
      https://kokolog.onrender.com
      TEXT
    %>

    <!-- æ—¥èªŒè¡¨ç¤º -->
    <div
      class="rounded-md border border-base-200 bg-base-100/60
             p-4 text-sm leading-relaxed text-base-content/80">
      <%= simple_format(tweet_text) %>
    </div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="flex justify-end gap-2 pt-2">
      <button type="button"
              data-action="click->modal#close"
              class="btn btn-sm btn-ghost">
        é–‰ã˜ã‚‹
      </button>

      <a href="https://twitter.com/intent/tweet?text=<%= ERB::Util.url_encode(tweet_text) %>"
         target="_blank"
         rel="noopener"
         class="btn btn-outline btn-sm group
                bg-neutral-900 text-white
                inline-flex items-center gap-2">
        <%= image_tag "logo-white.png",
          class: "w-4 h-4" %>
        ã«ã‚·ã‚§ã‚¢
      </a>
    </div>

  </div>
<% end %>
